**DBS311 学习备忘录 (End-Memo)**

本次对话主题：PL/SQL 语法、SQL 语句分类、触发器、循环控制、数据类型与赋值。

---

**I. PL/SQL 语法与赋值 (Variables & Blocks)**

1.  **变量声明 (DECLARE/AS):**
    * 在 PL/SQL 中声明变量时，无论是匿名块、存储过程/函数、还是触发器，**都不需要** `AS` 关键字。
    * 正确语法：`DECLARE variable_name DATATYPE;` 或在过程/函数中 `AS variable_name DATATYPE;` (注意：`AS` 是分隔符，不是声明的一部分)。

2.  **变量赋值 (:=):**
    * PL/SQL 使用 `:=` 作为**赋值运算符** (Assignment Operator)。
    * `=` 符号保留给 **比较运算** (Comparison)（如 `WHERE` 子句、`IF` 或 `CASE` 条件）。

3.  **`CASE` 结构的结束语法：**
    * **CASE 表达式 (返回一个值，用于赋值):** 必须以 **`END;`** 结束。
    * **CASE 语句 (执行逻辑，用于控制流):** 必须以 **`END CASE;`** 结束。

---

**II. SQL 语言与数据 (DML/DDL & NULL)**

4.  **SQL 语言分类：**
    * **DQL (Data Query Language):** `SELECT` (只读)。
    * **DML (Data Manipulation Language):** `INSERT`, `UPDATE`, `DELETE` (修改数据)。
    * **DDL (Data Definition Language):** `CREATE`, `ALTER`, `DROP` (修改结构)。
    * **总结：** `SELECT` 严格来说是 DQL，但常被归入广义的 DML 范畴。

5.  **`DELETE` 语句语法：**
    * `DELETE` 语句操作的是**行**，而不是列。
    * 语法：`DELETE FROM table_name [WHERE condition];`
    * **不需要**使用通配符 `*`。

6.  **`NULL` 比较规则：**
    * `NULL` 表示“未知的值”，不能与任何值进行常规比较。
    * `NULL = 10`, `NULL < 10` 的结果都是 **UNKNOWN**。
    * 正确的比较方式是使用 **`IS NULL`** 或 **`IS NOT NULL`**。

7.  **`CAST` 的用途：**
    * 用于强制进行**数据类型转换**。
    * 常见场景：在 `SELECT` 语句的 `CASE` 表达式中，当不同分支返回不同类型（如字符串和数字）时，需使用 `CAST` 确保所有分支返回兼容的单一类型。

8.  **字符参数引用：**
    * 在调用存储过程或函数时，字符类型 (`VARCHAR2`, `CHAR`) 的参数值**必须**用单引号 `' '` 包裹。

9.  **`NUMBER(P, S)` 数据类型：**
    * **P (Precision, 精度):** 总共的有效位数。
    * **S (Scale, 刻度):** 小数点后的位数。
    * 整数部分最大位数 = P - S。例如 `NUMBER(4, 1)` 最多有 3 位整数和 1 位小数。

---

**III. 触发器与程序单元 (Triggers & Identity)**

10. **触发器与表的关联：**
    * 触发器通过 `ON table_name` 直接绑定到目标表，无需额外关联。

11. **语句级 vs. 行级触发器：**
    * **语句级 (默认，无 `FOR EACH ROW`):** 执行 1 次，**不能**使用 `:OLD` 或 `:NEW`。
    * **行级 (`FOR EACH ROW`):** 执行 N 次 (受影响行数)，**可以使用** `:OLD` 和 `:NEW`。

12. **`:OLD` 和 `:NEW` 伪记录：**
    * `:OLD.column_name`: 操作前（旧）的值。
    * `:NEW.column_name`: 操作后（新）的值。
    * **最佳实践：** 对于行标识符（如主键）和未修改的列，最安全的方式是引用 **`:NEW.column_name`**。

13. **`IDENTITY` 列的插入：**
    * 要省略自动生成列并让数据库自动赋值，必须使用 **列列表法** (`INSERT INTO table_name (col2, col3) VALUES (val2, val3)` )。
    * 如果不想写列名，对于 `GENERATED BY DEFAULT` 的列，可以使用 `INSERT INTO table_name VALUES (DEFAULT, val2, val3, ...)`。

14. **客户端执行符：**
    * 在 SQL*Plus/SQL Developer 中，`END;` 后必须紧跟 **`/`** (斜杠)，它告诉客户端将整个 PL/SQL 块作为一个单元发送给数据库编译执行。

---

**IV. 循环控制 (LOOP Control)**

15. **`CONTINUE` vs. `EXIT`：**
    * **`CONTINUE`**: **跳过**当前迭代中剩余的语句，立即开始**下一次**迭代。
    * **`EXIT`**: **终止**当前的整个循环，程序流跳到 `END LOOP;` 之后。
    * 它们都只作用于**当前最内层**的循环。

